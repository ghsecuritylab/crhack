/*****************************************************************************/
/*                                                  ###                      */
/*       #####          ###    ###                  ###  CREATE: 2010-10-17  */
/*     #######          ###    ###      [CORE]      ###  ~~~~~~~~~~~~~~~~~~  */
/*    ########          ###    ###                  ###  MODIFY: XXXX-XX-XX  */
/*    ####  ##          ###    ###                  ###  ~~~~~~~~~~~~~~~~~~  */
/*   ###       ### ###  ###    ###    ####    ####  ###   ##  +-----------+  */
/*  ####       ######## ##########  #######  ###### ###  ###  |  A NEW C  |  */
/*  ###        ######## ########## ########  ###### ### ###   | FRAMEWORK |  */
/*  ###     ## #### ### ########## ###  ### ###     ######    |  FOR ALL  |  */
/*  ####   ### ###  ### ###    ### ###  ### ###     ######    | PLATFORMS |  */
/*  ########## ###      ###    ### ######## ####### #######   |  AND ALL  |  */
/*   #######   ###      ###    ### ########  ###### ###  ###  | COMPILERS |  */
/*    #####    ###      ###    ###  #### ##   ####  ###   ##  +-----------+  */
/*  =======================================================================  */
/*  >>>>>>>>>>>>>>>>>>>>> CrHack CAST6 加密解密函数库 <<<<<<<<<<<<<<<<<<<<<  */
/*  =======================================================================  */
/*****************************************************************************/

#include "crypto.h"
#include "morder.h"
#include "memlib.h"

/* CAST6 常数表 */
static const int32u _rom_ s_s1[256] =
{
    0x30FB40D4UL, 0x9FA0FF0BUL, 0x6BECCD2FUL, 0x3F258C7AUL, 0x1E213F2FUL,
    0x9C004DD3UL, 0x6003E540UL, 0xCF9FC949UL, 0xBFD4AF27UL, 0x88BBBDB5UL,
    0xE2034090UL, 0x98D09675UL, 0x6E63A0E0UL, 0x15C361D2UL, 0xC2E7661DUL,
    0x22D4FF8EUL, 0x28683B6FUL, 0xC07FD059UL, 0xFF2379C8UL, 0x775F50E2UL,
    0x43C340D3UL, 0xDF2F8656UL, 0x887CA41AUL, 0xA2D2BD2DUL, 0xA1C9E0D6UL,
    0x346C4819UL, 0x61B76D87UL, 0x22540F2FUL, 0x2ABE32E1UL, 0xAA54166BUL,
    0x22568E3AUL, 0xA2D341D0UL, 0x66DB40C8UL, 0xA784392FUL, 0x004DFF2FUL,
    0x2DB9D2DEUL, 0x97943FACUL, 0x4A97C1D8UL, 0x527644B7UL, 0xB5F437A7UL,
    0xB82CBAEFUL, 0xD751D159UL, 0x6FF7F0EDUL, 0x5A097A1FUL, 0x827B68D0UL,
    0x90ECF52EUL, 0x22B0C054UL, 0xBC8E5935UL, 0x4B6D2F7FUL, 0x50BB64A2UL,
    0xD2664910UL, 0xBEE5812DUL, 0xB7332290UL, 0xE93B159FUL, 0xB48EE411UL,
    0x4BFF345DUL, 0xFD45C240UL, 0xAD31973FUL, 0xC4F6D02EUL, 0x55FC8165UL,
    0xD5B1CAADUL, 0xA1AC2DAEUL, 0xA2D4B76DUL, 0xC19B0C50UL, 0x882240F2UL,
    0x0C6E4F38UL, 0xA4E4BFD7UL, 0x4F5BA272UL, 0x564C1D2FUL, 0xC59C5319UL,
    0xB949E354UL, 0xB04669FEUL, 0xB1B6AB8AUL, 0xC71358DDUL, 0x6385C545UL,
    0x110F935DUL, 0x57538AD5UL, 0x6A390493UL, 0xE63D37E0UL, 0x2A54F6B3UL,
    0x3A787D5FUL, 0x6276A0B5UL, 0x19A6FCDFUL, 0x7A42206AUL, 0x29F9D4D5UL,
    0xF61B1891UL, 0xBB72275EUL, 0xAA508167UL, 0x38901091UL, 0xC6B505EBUL,
    0x84C7CB8CUL, 0x2AD75A0FUL, 0x874A1427UL, 0xA2D1936BUL, 0x2AD286AFUL,
    0xAA56D291UL, 0xD7894360UL, 0x425C750DUL, 0x93B39E26UL, 0x187184C9UL,
    0x6C00B32DUL, 0x73E2BB14UL, 0xA0BEBC3CUL, 0x54623779UL, 0x64459EABUL,
    0x3F328B82UL, 0x7718CF82UL, 0x59A2CEA6UL, 0x04EE002EUL, 0x89FE78E6UL,
    0x3FAB0950UL, 0x325FF6C2UL, 0x81383F05UL, 0x6963C5C8UL, 0x76CB5AD6UL,
    0xD49974C9UL, 0xCA180DCFUL, 0x380782D5UL, 0xC7FA5CF6UL, 0x8AC31511UL,
    0x35E79E13UL, 0x47DA91D0UL, 0xF40F9086UL, 0xA7E2419EUL, 0x31366241UL,
    0x051EF495UL, 0xAA573B04UL, 0x4A805D8DUL, 0x548300D0UL, 0x00322A3CUL,
    0xBF64CDDFUL, 0xBA57A68EUL, 0x75C6372BUL, 0x50AFD341UL, 0xA7C13275UL,
    0x915A0BF5UL, 0x6B54BFABUL, 0x2B0B1426UL, 0xAB4CC9D7UL, 0x449CCD82UL,
    0xF7FBF265UL, 0xAB85C5F3UL, 0x1B55DB94UL, 0xAAD4E324UL, 0xCFA4BD3FUL,
    0x2DEAA3E2UL, 0x9E204D02UL, 0xC8BD25ACUL, 0xEADF55B3UL, 0xD5BD9E98UL,
    0xE31231B2UL, 0x2AD5AD6CUL, 0x954329DEUL, 0xADBE4528UL, 0xD8710F69UL,
    0xAA51C90FUL, 0xAA786BF6UL, 0x22513F1EUL, 0xAA51A79BUL, 0x2AD344CCUL,
    0x7B5A41F0UL, 0xD37CFBADUL, 0x1B069505UL, 0x41ECE491UL, 0xB4C332E6UL,
    0x032268D4UL, 0xC9600ACCUL, 0xCE387E6DUL, 0xBF6BB16CUL, 0x6A70FB78UL,
    0x0D03D9C9UL, 0xD4DF39DEUL, 0xE01063DAUL, 0x4736F464UL, 0x5AD328D8UL,
    0xB347CC96UL, 0x75BB0FC3UL, 0x98511BFBUL, 0x4FFBCC35UL, 0xB58BCF6AUL,
    0xE11F0ABCUL, 0xBFC5FE4AUL, 0xA70AEC10UL, 0xAC39570AUL, 0x3F04442FUL,
    0x6188B153UL, 0xE0397A2EUL, 0x5727CB79UL, 0x9CEB418FUL, 0x1CACD68DUL,
    0x2AD37C96UL, 0x0175CB9DUL, 0xC69DFF09UL, 0xC75B65F0UL, 0xD9DB40D8UL,
    0xEC0E7779UL, 0x4744EAD4UL, 0xB11C3274UL, 0xDD24CB9EUL, 0x7E1C54BDUL,
    0xF01144F9UL, 0xD2240EB1UL, 0x9675B3FDUL, 0xA3AC3755UL, 0xD47C27AFUL,
    0x51C85F4DUL, 0x56907596UL, 0xA5BB15E6UL, 0x580304F0UL, 0xCA042CF1UL,
    0x011A37EAUL, 0x8DBFAADBUL, 0x35BA3E4AUL, 0x3526FFA0UL, 0xC37B4D09UL,
    0xBC306ED9UL, 0x98A52666UL, 0x5648F725UL, 0xFF5E569DUL, 0x0CED63D0UL,
    0x7C63B2CFUL, 0x700B45E1UL, 0xD5EA50F1UL, 0x85A92872UL, 0xAF1FBDA7UL,
    0xD4234870UL, 0xA7870BF3UL, 0x2D3B4D79UL, 0x42E04198UL, 0x0CD0EDE7UL,
    0x26470DB8UL, 0xF881814CUL, 0x474D6AD7UL, 0x7C0C5E5CUL, 0xD1231959UL,
    0x381B7298UL, 0xF5D2F4DBUL, 0xAB838653UL, 0x6E2F1E23UL, 0x83719C9EUL,
    0xBD91E046UL, 0x9A56456EUL, 0xDC39200CUL, 0x20C8C571UL, 0x962BDA1CUL,
    0xE1E696FFUL, 0xB141AB08UL, 0x7CCA89B9UL, 0x1A69E783UL, 0x02CC4843UL,
    0xA2F7C579UL, 0x429EF47DUL, 0x427B169CUL, 0x5AC9F049UL, 0xDD8F0F00UL,
    0x5C8165BFUL,
};

static const int32u _rom_ s_s2[256] =
{
    0x1F201094UL, 0xEF0BA75BUL, 0x69E3CF7EUL, 0x393F4380UL, 0xFE61CF7AUL,
    0xEEC5207AUL, 0x55889C94UL, 0x72FC0651UL, 0xADA7EF79UL, 0x4E1D7235UL,
    0xD55A63CEUL, 0xDE0436BAUL, 0x99C430EFUL, 0x5F0C0794UL, 0x18DCDB7DUL,
    0xA1D6EFF3UL, 0xA0B52F7BUL, 0x59E83605UL, 0xEE15B094UL, 0xE9FFD909UL,
    0xDC440086UL, 0xEF944459UL, 0xBA83CCB3UL, 0xE0C3CDFBUL, 0xD1DA4181UL,
    0x3B092AB1UL, 0xF997F1C1UL, 0xA5E6CF7BUL, 0x01420DDBUL, 0xE4E7EF5BUL,
    0x25A1FF41UL, 0xE180F806UL, 0x1FC41080UL, 0x179BEE7AUL, 0xD37AC6A9UL,
    0xFE5830A4UL, 0x98DE8B7FUL, 0x77E83F4EUL, 0x79929269UL, 0x24FA9F7BUL,
    0xE113C85BUL, 0xACC40083UL, 0xD7503525UL, 0xF7EA615FUL, 0x62143154UL,
    0x0D554B63UL, 0x5D681121UL, 0xC866C359UL, 0x3D63CF73UL, 0xCEE234C0UL,
    0xD4D87E87UL, 0x5C672B21UL, 0x071F6181UL, 0x39F7627FUL, 0x361E3084UL,
    0xE4EB573BUL, 0x602F64A4UL, 0xD63ACD9CUL, 0x1BBC4635UL, 0x9E81032DUL,
    0x2701F50CUL, 0x99847AB4UL, 0xA0E3DF79UL, 0xBA6CF38CUL, 0x10843094UL,
    0x2537A95EUL, 0xF46F6FFEUL, 0xA1FF3B1FUL, 0x208CFB6AUL, 0x8F458C74UL,
    0xD9E0A227UL, 0x4EC73A34UL, 0xFC884F69UL, 0x3E4DE8DFUL, 0xEF0E0088UL,
    0x3559648DUL, 0x8A45388CUL, 0x1D804366UL, 0x721D9BFDUL, 0xA58684BBUL,
    0xE8256333UL, 0x844E8212UL, 0x128D8098UL, 0xFED33FB4UL, 0xCE280AE1UL,
    0x27E19BA5UL, 0xD5A6C252UL, 0xE49754BDUL, 0xC5D655DDUL, 0xEB667064UL,
    0x77840B4DUL, 0xA1B6A801UL, 0x84DB26A9UL, 0xE0B56714UL, 0x21F043B7UL,
    0xE5D05860UL, 0x54F03084UL, 0x066FF472UL, 0xA31AA153UL, 0xDADC4755UL,
    0xB5625DBFUL, 0x68561BE6UL, 0x83CA6B94UL, 0x2D6ED23BUL, 0xECCF01DBUL,
    0xA6D3D0BAUL, 0xB6803D5CUL, 0xAF77A709UL, 0x33B4A34CUL, 0x397BC8D6UL,
    0x5EE22B95UL, 0x5F0E5304UL, 0x81ED6F61UL, 0x20E74364UL, 0xB45E1378UL,
    0xDE18639BUL, 0x881CA122UL, 0xB96726D1UL, 0x8049A7E8UL, 0x22B7DA7BUL,
    0x5E552D25UL, 0x5272D237UL, 0x79D2951CUL, 0xC60D894CUL, 0x488CB402UL,
    0x1BA4FE5BUL, 0xA4B09F6BUL, 0x1CA815CFUL, 0xA20C3005UL, 0x8871DF63UL,
    0xB9DE2FCBUL, 0x0CC6C9E9UL, 0x0BEEFF53UL, 0xE3214517UL, 0xB4542835UL,
    0x9F63293CUL, 0xEE41E729UL, 0x6E1D2D7CUL, 0x50045286UL, 0x1E6685F3UL,
    0xF33401C6UL, 0x30A22C95UL, 0x31A70850UL, 0x60930F13UL, 0x73F98417UL,
    0xA1269859UL, 0xEC645C44UL, 0x52C877A9UL, 0xCDFF33A6UL, 0xA02B1741UL,
    0x7CBAD9A2UL, 0x2180036FUL, 0x50D99C08UL, 0xCB3F4861UL, 0xC26BD765UL,
    0x64A3F6ABUL, 0x80342676UL, 0x25A75E7BUL, 0xE4E6D1FCUL, 0x20C710E6UL,
    0xCDF0B680UL, 0x17844D3BUL, 0x31EEF84DUL, 0x7E0824E4UL, 0x2CCB49EBUL,
    0x846A3BAEUL, 0x8FF77888UL, 0xEE5D60F6UL, 0x7AF75673UL, 0x2FDD5CDBUL,
    0xA11631C1UL, 0x30F66F43UL, 0xB3FAEC54UL, 0x157FD7FAUL, 0xEF8579CCUL,
    0xD152DE58UL, 0xDB2FFD5EUL, 0x8F32CE19UL, 0x306AF97AUL, 0x02F03EF8UL,
    0x99319AD5UL, 0xC242FA0FUL, 0xA7E3EBB0UL, 0xC68E4906UL, 0xB8DA230CUL,
    0x80823028UL, 0xDCDEF3C8UL, 0xD35FB171UL, 0x088A1BC8UL, 0xBEC0C560UL,
    0x61A3C9E8UL, 0xBCA8F54DUL, 0xC72FEFFAUL, 0x22822E99UL, 0x82C570B4UL,
    0xD8D94E89UL, 0x8B1C34BCUL, 0x301E16E6UL, 0x273BE979UL, 0xB0FFEAA6UL,
    0x61D9B8C6UL, 0x00B24869UL, 0xB7FFCE3FUL, 0x08DC283BUL, 0x43DAF65AUL,
    0xF7E19798UL, 0x7619B72FUL, 0x8F1C9BA4UL, 0xDC8637A0UL, 0x16A7D3B1UL,
    0x9FC393B7UL, 0xA7136EEBUL, 0xC6BCC63EUL, 0x1A513742UL, 0xEF6828BCUL,
    0x520365D6UL, 0x2D6A77ABUL, 0x3527ED4BUL, 0x821FD216UL, 0x095C6E2EUL,
    0xDB92F2FBUL, 0x5EEA29CBUL, 0x145892F5UL, 0x91584F7FUL, 0x5483697BUL,
    0x2667A8CCUL, 0x85196048UL, 0x8C4BACEAUL, 0x833860D4UL, 0x0D23E0F9UL,
    0x6C387E8AUL, 0x0AE6D249UL, 0xB284600CUL, 0xD835731DUL, 0xDCB1C647UL,
    0xAC4C56EAUL, 0x3EBD81B3UL, 0x230EABB0UL, 0x6438BC87UL, 0xF0B5B1FAUL,
    0x8F5EA2B3UL, 0xFC184642UL, 0x0A036B7AUL, 0x4FB089BDUL, 0x649DA589UL,
    0xA345415EUL, 0x5C038323UL, 0x3E5D3BB9UL, 0x43D79572UL, 0x7E6DD07CUL,
    0x06DFDF1EUL, 0x6C6CC4EFUL, 0x7160A539UL, 0x73BFBE70UL, 0x83877605UL,
    0x4523ECF1UL,
};

static const int32u _rom_ s_s3[256] =
{
    0x8DEFC240UL, 0x25FA5D9FUL, 0xEB903DBFUL, 0xE810C907UL, 0x47607FFFUL,
    0x369FE44BUL, 0x8C1FC644UL, 0xAECECA90UL, 0xBEB1F9BFUL, 0xEEFBCAEAUL,
    0xE8CF1950UL, 0x51DF07AEUL, 0x920E8806UL, 0xF0AD0548UL, 0xE13C8D83UL,
    0x927010D5UL, 0x11107D9FUL, 0x07647DB9UL, 0xB2E3E4D4UL, 0x3D4F285EUL,
    0xB9AFA820UL, 0xFADE82E0UL, 0xA067268BUL, 0x8272792EUL, 0x553FB2C0UL,
    0x489AE22BUL, 0xD4EF9794UL, 0x125E3FBCUL, 0x21FFFCEEUL, 0x825B1BFDUL,
    0x9255C5EDUL, 0x1257A240UL, 0x4E1A8302UL, 0xBAE07FFFUL, 0x528246E7UL,
    0x8E57140EUL, 0x3373F7BFUL, 0x8C9F8188UL, 0xA6FC4EE8UL, 0xC982B5A5UL,
    0xA8C01DB7UL, 0x579FC264UL, 0x67094F31UL, 0xF2BD3F5FUL, 0x40FFF7C1UL,
    0x1FB78DFCUL, 0x8E6BD2C1UL, 0x437BE59BUL, 0x99B03DBFUL, 0xB5DBC64BUL,
    0x638DC0E6UL, 0x55819D99UL, 0xA197C81CUL, 0x4A012D6EUL, 0xC5884A28UL,
    0xCCC36F71UL, 0xB843C213UL, 0x6C0743F1UL, 0x8309893CUL, 0x0FEDDD5FUL,
    0x2F7FE850UL, 0xD7C07F7EUL, 0x02507FBFUL, 0x5AFB9A04UL, 0xA747D2D0UL,
    0x1651192EUL, 0xAF70BF3EUL, 0x58C31380UL, 0x5F98302EUL, 0x727CC3C4UL,
    0x0A0FB402UL, 0x0F7FEF82UL, 0x8C96FDADUL, 0x5D2C2AAEUL, 0x8EE99A49UL,
    0x50DA88B8UL, 0x8427F4A0UL, 0x1EAC5790UL, 0x796FB449UL, 0x8252DC15UL,
    0xEFBD7D9BUL, 0xA672597DUL, 0xADA840D8UL, 0x45F54504UL, 0xFA5D7403UL,
    0xE83EC305UL, 0x4F91751AUL, 0x925669C2UL, 0x23EFE941UL, 0xA903F12EUL,
    0x60270DF2UL, 0x0276E4B6UL, 0x94FD6574UL, 0x927985B2UL, 0x8276DBCBUL,
    0x02778176UL, 0xF8AF918DUL, 0x4E48F79EUL, 0x8F616DDFUL, 0xE29D840EUL,
    0x842F7D83UL, 0x340CE5C8UL, 0x96BBB682UL, 0x93B4B148UL, 0xEF303CABUL,
    0x984FAF28UL, 0x779FAF9BUL, 0x92DC560DUL, 0x224D1E20UL, 0x8437AA88UL,
    0x7D29DC96UL, 0x2756D3DCUL, 0x8B907CEEUL, 0xB51FD240UL, 0xE7C07CE3UL,
    0xE566B4A1UL, 0xC3E9615EUL, 0x3CF8209DUL, 0x6094D1E3UL, 0xCD9CA341UL,
    0x5C76460EUL, 0x00EA983BUL, 0xD4D67881UL, 0xFD47572CUL, 0xF76CEDD9UL,
    0xBDA8229CUL, 0x127DADAAUL, 0x438A074EUL, 0x1F97C090UL, 0x081BDB8AUL,
    0x93A07EBEUL, 0xB938CA15UL, 0x97B03CFFUL, 0x3DC2C0F8UL, 0x8D1AB2ECUL,
    0x64380E51UL, 0x68CC7BFBUL, 0xD90F2788UL, 0x12490181UL, 0x5DE5FFD4UL,
    0xDD7EF86AUL, 0x76A2E214UL, 0xB9A40368UL, 0x925D958FUL, 0x4B39FFFAUL,
    0xBA39AEE9UL, 0xA4FFD30BUL, 0xFAF7933BUL, 0x6D498623UL, 0x193CBCFAUL,
    0x27627545UL, 0x825CF47AUL, 0x61BD8BA0UL, 0xD11E42D1UL, 0xCEAD04F4UL,
    0x127EA392UL, 0x10428DB7UL, 0x8272A972UL, 0x9270C4A8UL, 0x127DE50BUL,
    0x285BA1C8UL, 0x3C62F44FUL, 0x35C0EAA5UL, 0xE805D231UL, 0x428929FBUL,
    0xB4FCDF82UL, 0x4FB66A53UL, 0x0E7DC15BUL, 0x1F081FABUL, 0x108618AEUL,
    0xFCFD086DUL, 0xF9FF2889UL, 0x694BCC11UL, 0x236A5CAEUL, 0x12DECA4DUL,
    0x2C3F8CC5UL, 0xD2D02DFEUL, 0xF8EF5896UL, 0xE4CF52DAUL, 0x95155B67UL,
    0x494A488CUL, 0xB9B6A80CUL, 0x5C8F82BCUL, 0x89D36B45UL, 0x3A609437UL,
    0xEC00C9A9UL, 0x44715253UL, 0x0A874B49UL, 0xD773BC40UL, 0x7C34671CUL,
    0x02717EF6UL, 0x4FEB5536UL, 0xA2D02FFFUL, 0xD2BF60C4UL, 0xD43F03C0UL,
    0x50B4EF6DUL, 0x07478CD1UL, 0x006E1888UL, 0xA2E53F55UL, 0xB9E6D4BCUL,
    0xA2048016UL, 0x97573833UL, 0xD7207D67UL, 0xDE0F8F3DUL, 0x72F87B33UL,
    0xABCC4F33UL, 0x7688C55DUL, 0x7B00A6B0UL, 0x947B0001UL, 0x570075D2UL,
    0xF9BB88F8UL, 0x8942019EUL, 0x4264A5FFUL, 0x856302E0UL, 0x72DBD92BUL,
    0xEE971B69UL, 0x6EA22FDEUL, 0x5F08AE2BUL, 0xAF7A616DUL, 0xE5C98767UL,
    0xCF1FEBD2UL, 0x61EFC8C2UL, 0xF1AC2571UL, 0xCC8239C2UL, 0x67214CB8UL,
    0xB1E583D1UL, 0xB7DC3E62UL, 0x7F10BDCEUL, 0xF90A5C38UL, 0x0FF0443DUL,
    0x606E6DC6UL, 0x60543A49UL, 0x5727C148UL, 0x2BE98A1DUL, 0x8AB41738UL,
    0x20E1BE24UL, 0xAF96DA0FUL, 0x68458425UL, 0x99833BE5UL, 0x600D457DUL,
    0x282F9350UL, 0x8334B362UL, 0xD91D1120UL, 0x2B6D8DA0UL, 0x642B1E31UL,
    0x9C305A00UL, 0x52BCE688UL, 0x1B03588AUL, 0xF7BAEFD5UL, 0x4142ED9CUL,
    0xA4315C11UL, 0x83323EC5UL, 0xDFEF4636UL, 0xA133C501UL, 0xE9D3531CUL,
    0xEE353783UL,
};

static const int32u _rom_ s_s4[256] =
{
    0x9DB30420UL, 0x1FB6E9DEUL, 0xA7BE7BEFUL, 0xD273A298UL, 0x4A4F7BDBUL,
    0x64AD8C57UL, 0x85510443UL, 0xFA020ED1UL, 0x7E287AFFUL, 0xE60FB663UL,
    0x095F35A1UL, 0x79EBF120UL, 0xFD059D43UL, 0x6497B7B1UL, 0xF3641F63UL,
    0x241E4ADFUL, 0x28147F5FUL, 0x4FA2B8CDUL, 0xC9430040UL, 0x0CC32220UL,
    0xFDD30B30UL, 0xC0A5374FUL, 0x1D2D00D9UL, 0x24147B15UL, 0xEE4D111AUL,
    0x0FCA5167UL, 0x71FF904CUL, 0x2D195FFEUL, 0x1A05645FUL, 0x0C13FEFEUL,
    0x081B08CAUL, 0x05170121UL, 0x80530100UL, 0xE83E5EFEUL, 0xAC9AF4F8UL,
    0x7FE72701UL, 0xD2B8EE5FUL, 0x06DF4261UL, 0xBB9E9B8AUL, 0x7293EA25UL,
    0xCE84FFDFUL, 0xF5718801UL, 0x3DD64B04UL, 0xA26F263BUL, 0x7ED48400UL,
    0x547EEBE6UL, 0x446D4CA0UL, 0x6CF3D6F5UL, 0x2649ABDFUL, 0xAEA0C7F5UL,
    0x36338CC1UL, 0x503F7E93UL, 0xD3772061UL, 0x11B638E1UL, 0x72500E03UL,
    0xF80EB2BBUL, 0xABE0502EUL, 0xEC8D77DEUL, 0x57971E81UL, 0xE14F6746UL,
    0xC9335400UL, 0x6920318FUL, 0x081DBB99UL, 0xFFC304A5UL, 0x4D351805UL,
    0x7F3D5CE3UL, 0xA6C866C6UL, 0x5D5BCCA9UL, 0xDAEC6FEAUL, 0x9F926F91UL,
    0x9F46222FUL, 0x3991467DUL, 0xA5BF6D8EUL, 0x1143C44FUL, 0x43958302UL,
    0xD0214EEBUL, 0x022083B8UL, 0x3FB6180CUL, 0x18F8931EUL, 0x281658E6UL,
    0x26486E3EUL, 0x8BD78A70UL, 0x7477E4C1UL, 0xB506E07CUL, 0xF32D0A25UL,
    0x79098B02UL, 0xE4EABB81UL, 0x28123B23UL, 0x69DEAD38UL, 0x1574CA16UL,
    0xDF871B62UL, 0x211C40B7UL, 0xA51A9EF9UL, 0x0014377BUL, 0x041E8AC8UL,
    0x09114003UL, 0xBD59E4D2UL, 0xE3D156D5UL, 0x4FE876D5UL, 0x2F91A340UL,
    0x557BE8DEUL, 0x00EAE4A7UL, 0x0CE5C2ECUL, 0x4DB4BBA6UL, 0xE756BDFFUL,
    0xDD3369ACUL, 0xEC17B035UL, 0x06572327UL, 0x99AFC8B0UL, 0x56C8C391UL,
    0x6B65811CUL, 0x5E146119UL, 0x6E85CB75UL, 0xBE07C002UL, 0xC2325577UL,
    0x893FF4ECUL, 0x5BBFC92DUL, 0xD0EC3B25UL, 0xB7801AB7UL, 0x8D6D3B24UL,
    0x20C763EFUL, 0xC366A5FCUL, 0x9C382880UL, 0x0ACE3205UL, 0xAAC9548AUL,
    0xECA1D7C7UL, 0x041AFA32UL, 0x1D16625AUL, 0x6701902CUL, 0x9B757A54UL,
    0x31D477F7UL, 0x9126B031UL, 0x36CC6FDBUL, 0xC70B8B46UL, 0xD9E66A48UL,
    0x56E55A79UL, 0x026A4CEBUL, 0x52437EFFUL, 0x2F8F76B4UL, 0x0DF980A5UL,
    0x8674CDE3UL, 0xEDDA04EBUL, 0x17A9BE04UL, 0x2C18F4DFUL, 0xB7747F9DUL,
    0xAB2AF7B4UL, 0xEFC34D20UL, 0x2E096B7CUL, 0x1741A254UL, 0xE5B6A035UL,
    0x213D42F6UL, 0x2C1C7C26UL, 0x61C2F50FUL, 0x6552DAF9UL, 0xD2C231F8UL,
    0x25130F69UL, 0xD8167FA2UL, 0x0418F2C8UL, 0x001A96A6UL, 0x0D1526ABUL,
    0x63315C21UL, 0x5E0A72ECUL, 0x49BAFEFDUL, 0x187908D9UL, 0x8D0DBD86UL,
    0x311170A7UL, 0x3E9B640CUL, 0xCC3E10D7UL, 0xD5CAD3B6UL, 0x0CAEC388UL,
    0xF73001E1UL, 0x6C728AFFUL, 0x71EAE2A1UL, 0x1F9AF36EUL, 0xCFCBD12FUL,
    0xC1DE8417UL, 0xAC07BE6BUL, 0xCB44A1D8UL, 0x8B9B0F56UL, 0x013988C3UL,
    0xB1C52FCAUL, 0xB4BE31CDUL, 0xD8782806UL, 0x12A3A4E2UL, 0x6F7DE532UL,
    0x58FD7EB6UL, 0xD01EE900UL, 0x24ADFFC2UL, 0xF4990FC5UL, 0x9711AAC5UL,
    0x001D7B95UL, 0x82E5E7D2UL, 0x109873F6UL, 0x00613096UL, 0xC32D9521UL,
    0xADA121FFUL, 0x29908415UL, 0x7FBB977FUL, 0xAF9EB3DBUL, 0x29C9ED2AUL,
    0x5CE2A465UL, 0xA730F32CUL, 0xD0AA3FE8UL, 0x8A5CC091UL, 0xD49E2CE7UL,
    0x0CE454A9UL, 0xD60ACD86UL, 0x015F1919UL, 0x77079103UL, 0xDEA03AF6UL,
    0x78A8565EUL, 0xDEE356DFUL, 0x21F05CBEUL, 0x8B75E387UL, 0xB3C50651UL,
    0xB8A5C3EFUL, 0xD8EEB6D2UL, 0xE523BE77UL, 0xC2154529UL, 0x2F69EFDFUL,
    0xAFE67AFBUL, 0xF470C4B2UL, 0xF3E0EB5BUL, 0xD6CC9876UL, 0x39E4460CUL,
    0x1FDA8538UL, 0x1987832FUL, 0xCA007367UL, 0xA99144F8UL, 0x296B299EUL,
    0x492FC295UL, 0x9266BEABUL, 0xB5676E69UL, 0x9BD3DDDAUL, 0xDF7E052FUL,
    0xDB25701CUL, 0x1B5E51EEUL, 0xF65324E6UL, 0x6AFCE36CUL, 0x0316CC04UL,
    0x8644213EUL, 0xB7DC59D0UL, 0x7965291FUL, 0xCCD6FD43UL, 0x41823979UL,
    0x932BCDF6UL, 0xB657C34DUL, 0x4EDFD282UL, 0x7AE5290CUL, 0x3CB9536BUL,
    0x851E20FEUL, 0x9833557EUL, 0x13ECF0B0UL, 0xD3FFB372UL, 0x3F85C5C1UL,
    0x0AEF7ED2UL,
};

static const int32u _rom_ s_tm[24][8] =
{
    { 0x5A827999UL, 0xC95C653AUL, 0x383650DBUL, 0xA7103C7CUL,
      0x15EA281DUL, 0x84C413BEUL, 0xF39DFF5FUL, 0x6277EB00UL, },
    { 0xD151D6A1UL, 0x402BC242UL, 0xAF05ADE3UL, 0x1DDF9984UL,
      0x8CB98525UL, 0xFB9370C6UL, 0x6A6D5C67UL, 0xD9474808UL, },
    { 0x482133A9UL, 0xB6FB1F4AUL, 0x25D50AEBUL, 0x94AEF68CUL,
      0x0388E22DUL, 0x7262CDCEUL, 0xE13CB96FUL, 0x5016A510UL, },
    { 0xBEF090B1UL, 0x2DCA7C52UL, 0x9CA467F3UL, 0x0B7E5394UL,
      0x7A583F35UL, 0xE9322AD6UL, 0x580C1677UL, 0xC6E60218UL, },
    { 0x35BFEDB9UL, 0xA499D95AUL, 0x1373C4FBUL, 0x824DB09CUL,
      0xF1279C3DUL, 0x600187DEUL, 0xCEDB737FUL, 0x3DB55F20UL, },
    { 0xAC8F4AC1UL, 0x1B693662UL, 0x8A432203UL, 0xF91D0DA4UL,
      0x67F6F945UL, 0xD6D0E4E6UL, 0x45AAD087UL, 0xB484BC28UL, },
    { 0x235EA7C9UL, 0x9238936AUL, 0x01127F0BUL, 0x6FEC6AACUL,
      0xDEC6564DUL, 0x4DA041EEUL, 0xBC7A2D8FUL, 0x2B541930UL, },
    { 0x9A2E04D1UL, 0x0907F072UL, 0x77E1DC13UL, 0xE6BBC7B4UL,
      0x5595B355UL, 0xC46F9EF6UL, 0x33498A97UL, 0xA2237638UL, },
    { 0x10FD61D9UL, 0x7FD74D7AUL, 0xEEB1391BUL, 0x5D8B24BCUL,
      0xCC65105DUL, 0x3B3EFBFEUL, 0xAA18E79FUL, 0x18F2D340UL, },
    { 0x87CCBEE1UL, 0xF6A6AA82UL, 0x65809623UL, 0xD45A81C4UL,
      0x43346D65UL, 0xB20E5906UL, 0x20E844A7UL, 0x8FC23048UL, },
    { 0xFE9C1BE9UL, 0x6D76078AUL, 0xDC4FF32BUL, 0x4B29DECCUL,
      0xBA03CA6DUL, 0x28DDB60EUL, 0x97B7A1AFUL, 0x06918D50UL, },
    { 0x756B78F1UL, 0xE4456492UL, 0x531F5033UL, 0xC1F93BD4UL,
      0x30D32775UL, 0x9FAD1316UL, 0x0E86FEB7UL, 0x7D60EA58UL, },
    { 0xEC3AD5F9UL, 0x5B14C19AUL, 0xC9EEAD3BUL, 0x38C898DCUL,
      0xA7A2847DUL, 0x167C701EUL, 0x85565BBFUL, 0xF4304760UL, },
    { 0x630A3301UL, 0xD1E41EA2UL, 0x40BE0A43UL, 0xAF97F5E4UL,
      0x1E71E185UL, 0x8D4BCD26UL, 0xFC25B8C7UL, 0x6AFFA468UL, },
    { 0xD9D99009UL, 0x48B37BAAUL, 0xB78D674BUL, 0x266752ECUL,
      0x95413E8DUL, 0x041B2A2EUL, 0x72F515CFUL, 0xE1CF0170UL, },
    { 0x50A8ED11UL, 0xBF82D8B2UL, 0x2E5CC453UL, 0x9D36AFF4UL,
      0x0C109B95UL, 0x7AEA8736UL, 0xE9C472D7UL, 0x589E5E78UL, },
    { 0xC7784A19UL, 0x365235BAUL, 0xA52C215BUL, 0x14060CFCUL,
      0x82DFF89DUL, 0xF1B9E43EUL, 0x6093CFDFUL, 0xCF6DBB80UL, },
    { 0x3E47A721UL, 0xAD2192C2UL, 0x1BFB7E63UL, 0x8AD56A04UL,
      0xF9AF55A5UL, 0x68894146UL, 0xD7632CE7UL, 0x463D1888UL, },
    { 0xB5170429UL, 0x23F0EFCAUL, 0x92CADB6BUL, 0x01A4C70CUL,
      0x707EB2ADUL, 0xDF589E4EUL, 0x4E3289EFUL, 0xBD0C7590UL, },
    { 0x2BE66131UL, 0x9AC04CD2UL, 0x099A3873UL, 0x78742414UL,
      0xE74E0FB5UL, 0x5627FB56UL, 0xC501E6F7UL, 0x33DBD298UL, },
    { 0xA2B5BE39UL, 0x118FA9DAUL, 0x8069957BUL, 0xEF43811CUL,
      0x5E1D6CBDUL, 0xCCF7585EUL, 0x3BD143FFUL, 0xAAAB2FA0UL, },
    { 0x19851B41UL, 0x885F06E2UL, 0xF738F283UL, 0x6612DE24UL,
      0xD4ECC9C5UL, 0x43C6B566UL, 0xB2A0A107UL, 0x217A8CA8UL, },
    { 0x90547849UL, 0xFF2E63EAUL, 0x6E084F8BUL, 0xDCE23B2CUL,
      0x4BBC26CDUL, 0xBA96126EUL, 0x296FFE0FUL, 0x9849E9B0UL, },
    { 0x0723D551UL, 0x75FDC0F2UL, 0xE4D7AC93UL, 0x53B19834UL,
      0xC28B83D5UL, 0x31656F76UL, 0xA03F5B17UL, 0x0F1946B8UL, },
};

static const byte_t _rom_ s_tr[4][8] =
{
    { 0x13, 0x04, 0x15, 0x06, 0x17, 0x08, 0x19, 0x0A, },
    { 0x1B, 0x0C, 0x1D, 0x0E, 0x1F, 0x10, 0x01, 0x12, },
    { 0x03, 0x14, 0x05, 0x16, 0x07, 0x18, 0x09, 0x1A, },
    { 0x0B, 0x1C, 0x0D, 0x1E, 0x0F, 0x00, 0x11, 0x02, },
};

/* CAST6 计算宏 */
#define CAST6_F1(D, r, m) \
            ((I = ((m) + (D))), (I = rotl_int32u(I, (r))), \
            (((s_s1[(I >> 24)] ^ s_s2[(I >> 16) & 0xFF]) - \
               s_s3[(I >>  8) & 0xFF]) + s_s4[I & 0xFF]))

#define CAST6_F2(D, r, m) \
            ((I = ((m) ^ (D))), (I = rotl_int32u(I, (r))), \
            (((s_s1[(I >> 24)] - s_s2[(I >> 16) & 0xFF]) + \
               s_s3[(I >>  8) & 0xFF]) ^ s_s4[I & 0xFF]))

#define CAST6_F3(D, r, m) \
            ((I = ((m) - (D))), (I = rotl_int32u(I, (r))), \
            (((s_s1[(I >> 24)] + s_s2[(I >> 16) & 0xFF]) ^ \
               s_s3[(I >>  8) & 0xFF]) - s_s4[I & 0xFF]))
/*
---------------------------------------
    向前八轮
---------------------------------------
*/
static void_t
CAST6_W (
  __CR_IO__ int32u* key,
  __CR_IN__ uint_t  idx
    )
{
    int32u  I;

    key[6] ^= CAST6_F1(key[7], s_tr[idx % 4][0], s_tm[idx][0]);
    key[5] ^= CAST6_F2(key[6], s_tr[idx % 4][1], s_tm[idx][1]);
    key[4] ^= CAST6_F3(key[5], s_tr[idx % 4][2], s_tm[idx][2]);
    key[3] ^= CAST6_F1(key[4], s_tr[idx % 4][3], s_tm[idx][3]);
    key[2] ^= CAST6_F2(key[3], s_tr[idx % 4][4], s_tm[idx][4]);
    key[1] ^= CAST6_F3(key[2], s_tr[idx % 4][5], s_tm[idx][5]);
    key[0] ^= CAST6_F1(key[1], s_tr[idx % 4][6], s_tm[idx][6]);
    key[7] ^= CAST6_F2(key[0], s_tr[idx % 4][7], s_tm[idx][7]);
}

/*
---------------------------------------
    向前四轮
---------------------------------------
*/
static void_t
CAST6_Q (
  __CR_IO__ int32u*         bk,
  __CR_IN__ const byte_t*   kr,
  __CR_IN__ const int32u*   km
    )
{
    int32u  I;

    bk[2] ^= CAST6_F1(bk[3], kr[0], km[0]);
    bk[1] ^= CAST6_F2(bk[2], kr[1], km[1]);
    bk[0] ^= CAST6_F3(bk[1], kr[2], km[2]);
    bk[3] ^= CAST6_F1(bk[0], kr[3], km[3]);
}

/*
---------------------------------------
    反向四轮
---------------------------------------
*/
static void_t
CAST6_B (
  __CR_IO__ int32u*         bk,
  __CR_IN__ const byte_t*   kr,
  __CR_IN__ const int32u*   km
    )
{
    int32u  I;

    bk[3] ^= CAST6_F1(bk[0], kr[3], km[3]);
    bk[0] ^= CAST6_F3(bk[1], kr[2], km[2]);
    bk[1] ^= CAST6_F2(bk[2], kr[1], km[1]);
    bk[2] ^= CAST6_F1(bk[3], kr[0], km[0]);
}

/*
=======================================
    CAST6 设置密钥
=======================================
*/
CR_API void_t
crypto_cast6_key (
  __CR_OT__ sCAST6*         ctx,
  __CR_IN__ const void_t*   key,
  __CR_IN__ leng_t          keylen
    )
{
    uint_t  idx;
    int32u  dkey[8];
    int32u  p_key[8];

    if (keylen > 32)
        keylen = 32;
    mem_set(p_key, 0x0, 32);
    mem_cpy(p_key, key, keylen);
    dkey[0] = DWORD_BE(p_key[0]);
    dkey[1] = DWORD_BE(p_key[1]);
    dkey[2] = DWORD_BE(p_key[2]);
    dkey[3] = DWORD_BE(p_key[3]);
    dkey[4] = DWORD_BE(p_key[4]);
    dkey[5] = DWORD_BE(p_key[5]);
    dkey[6] = DWORD_BE(p_key[6]);
    dkey[7] = DWORD_BE(p_key[7]);
    for (idx = 0; idx < 12; idx++) {
        CAST6_W(dkey, 2 * idx + 0);
        CAST6_W(dkey, 2 * idx + 1);
        ctx->kr[idx][0] = (byte_t)(dkey[0] & 0x1F);
        ctx->kr[idx][1] = (byte_t)(dkey[2] & 0x1F);
        ctx->kr[idx][2] = (byte_t)(dkey[4] & 0x1F);
        ctx->kr[idx][3] = (byte_t)(dkey[6] & 0x1F);
        ctx->km[idx][0] = (int32u)(dkey[7]);
        ctx->km[idx][1] = (int32u)(dkey[5]);
        ctx->km[idx][2] = (int32u)(dkey[3]);
        ctx->km[idx][3] = (int32u)(dkey[1]);
    }
}

/*
=======================================
    CAST6 加密
=======================================
*/
CR_API void_t
crypto_cast6_enc (
  __CR_IN__ const sCAST6*   ctx,
  __CR_OT__ int32u          dst[4],
  __CR_IN__ const int32u    src[4]
    )
{
    int32u      blk[4];
    const byte_t*   kr;
    const int32u*   km;

    blk[0] = DWORD_BE(src[0]);
    blk[1] = DWORD_BE(src[1]);
    blk[2] = DWORD_BE(src[2]);
    blk[3] = DWORD_BE(src[3]);
    km = ctx->km[ 0]; kr = ctx->kr[ 0]; CAST6_Q(blk, kr, km);
    km = ctx->km[ 1]; kr = ctx->kr[ 1]; CAST6_Q(blk, kr, km);
    km = ctx->km[ 2]; kr = ctx->kr[ 2]; CAST6_Q(blk, kr, km);
    km = ctx->km[ 3]; kr = ctx->kr[ 3]; CAST6_Q(blk, kr, km);
    km = ctx->km[ 4]; kr = ctx->kr[ 4]; CAST6_Q(blk, kr, km);
    km = ctx->km[ 5]; kr = ctx->kr[ 5]; CAST6_Q(blk, kr, km);
    km = ctx->km[ 6]; kr = ctx->kr[ 6]; CAST6_B(blk, kr, km);
    km = ctx->km[ 7]; kr = ctx->kr[ 7]; CAST6_B(blk, kr, km);
    km = ctx->km[ 8]; kr = ctx->kr[ 8]; CAST6_B(blk, kr, km);
    km = ctx->km[ 9]; kr = ctx->kr[ 9]; CAST6_B(blk, kr, km);
    km = ctx->km[10]; kr = ctx->kr[10]; CAST6_B(blk, kr, km);
    km = ctx->km[11]; kr = ctx->kr[11]; CAST6_B(blk, kr, km);
    dst[0] = DWORD_BE(blk[0]);
    dst[1] = DWORD_BE(blk[1]);
    dst[2] = DWORD_BE(blk[2]);
    dst[3] = DWORD_BE(blk[3]);
}

/*
=======================================
    CAST6 解密
=======================================
*/
CR_API void_t
crypto_cast6_dec (
  __CR_IN__ const sCAST6*   ctx,
  __CR_OT__ int32u          dst[4],
  __CR_IN__ const int32u    src[4]
    )
{
    int32u      blk[4];
    const byte_t*   kr;
    const int32u*   km;

    blk[0] = DWORD_BE(src[0]);
    blk[1] = DWORD_BE(src[1]);
    blk[2] = DWORD_BE(src[2]);
    blk[3] = DWORD_BE(src[3]);
    km = ctx->km[11]; kr = ctx->kr[11]; CAST6_Q(blk, kr, km);
    km = ctx->km[10]; kr = ctx->kr[10]; CAST6_Q(blk, kr, km);
    km = ctx->km[ 9]; kr = ctx->kr[ 9]; CAST6_Q(blk, kr, km);
    km = ctx->km[ 8]; kr = ctx->kr[ 8]; CAST6_Q(blk, kr, km);
    km = ctx->km[ 7]; kr = ctx->kr[ 7]; CAST6_Q(blk, kr, km);
    km = ctx->km[ 6]; kr = ctx->kr[ 6]; CAST6_Q(blk, kr, km);
    km = ctx->km[ 5]; kr = ctx->kr[ 5]; CAST6_B(blk, kr, km);
    km = ctx->km[ 4]; kr = ctx->kr[ 4]; CAST6_B(blk, kr, km);
    km = ctx->km[ 3]; kr = ctx->kr[ 3]; CAST6_B(blk, kr, km);
    km = ctx->km[ 2]; kr = ctx->kr[ 2]; CAST6_B(blk, kr, km);
    km = ctx->km[ 1]; kr = ctx->kr[ 1]; CAST6_B(blk, kr, km);
    km = ctx->km[ 0]; kr = ctx->kr[ 0]; CAST6_B(blk, kr, km);
    dst[0] = DWORD_BE(blk[0]);
    dst[1] = DWORD_BE(blk[1]);
    dst[2] = DWORD_BE(blk[2]);
    dst[3] = DWORD_BE(blk[3]);
}

/*****************************************************************************/
/* _________________________________________________________________________ */
/* uBMAzRBoAKAHaACQD6FoAIAPqbgA/7rIA+5CM9uKw8D4Au7u7mSIJ0t18mYz0mYz9rAQZCgHc */
/* wRIZIgHZovGBXUAZg+v0GbB+gRmgcJ7BAAAisIlAwB1Av7LSHUC/s9IdQL+w0h1Av7HZkZmgf */
/* 4JLgIAdb262gPsqAh0+zP/uQB9ZYsFZYktq+L3sMi/AAK7gAKJAUtLdfq5IANXvT8BiQzfBIv */
/* FLaAAweAEmff53wb+Adjx3kQE2xwy5Io8ithkigcFgACJBN8E3sneNvwB2xyLHDkdfA2JHSyA */
/* adtAAQPdZYgHR0dNdbZfSYP5UHWr/kQEtAHNFg+Eef/DWAKgDw== |~~~~~~~~~~~~~~~~~~~ */
/* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ >>> END OF FILE <<< */
/*****************************************************************************/
